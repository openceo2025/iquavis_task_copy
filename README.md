**概要**
- iQUAVIS の Web API を使用し、CUI でログイン → プロジェクト選択 → 対象プロジェクトのタスクを .xlsx で書き出すツールです。
- 参照サンプルと API リファレンスは `ref/` 配下にあります。

**前提条件**
- **Python**: 3.9 以上
- **ネットワーク**: `http://rdgpm0701/iquavis-api` へ到達可能
- **認証情報**: iQUAVIS のユーザーID/パスワード

**インストール**
- 依存パッケージをインストール:
  - `pip install requests openpyxl`
  - 任意で仮想環境: `python -m venv .venv` → `source .venv/bin/activate`（Windows は ` .venv\\Scripts\\activate`）

**使い方**
- コマンド実行: `python export_tasks_cli.py`
- プロンプトに従い以下を入力します。
  - **User ID**: iQUAVIS のユーザーID
  - **Password**: パスワード（入力は画面非表示）
 - 認証成功後、既存の Excel ファイルパスを入力します（未入力の場合は全プロジェクトを取得）。
   - 指定ファイルに `project` シートがあり内容が存在する場合、その一覧からプロジェクトを選択できます。
   - シートが無い、または空の場合は API から全プロジェクトを取得します。
 - プロジェクト選択後、そのプロジェクトのタスクを取得し、同ディレクトリに `.xlsx` で書き出します。

**出力仕様**
- **出力先**: スクリプトと同一ディレクトリ
- **ファイル名**: `tasks_{プロジェクト名}.xlsx`
  - 同名ファイルがある場合は `tasks_{プロジェクト名} (1).xlsx` のように連番サフィックスを付与して上書きを回避します。
- **シート構成**: 左端に `project` シート、右側に `tasks` シートの 2 枚を出力します。
  - 指定した既存ファイルがある場合は `project` シートのみコピーし、他シートは無視します。
- **ヘッダー行**: Task オブジェクトが持ちうるプロパティの集合を列（1 行目）として `tasks` シートに出力します。
  - ネストは `Parent.Child` のドット区切りでフラット化。
  - 配列（例: `Assigns`, `Todos`）は JSON 文字列として 1 列に格納します。

**環境変数（任意）**
- **`IQUAVIS_BASE_URL`**: 接続先 API ベース URL を上書き可能（既定: `http://rdgpm0701/iquavis-api`）。

**注意事項**
- **SSL 検証**: 社内ネットワーク想定によりサンプル同様 `verify=False` でアクセスします（警告は抑止）。必要に応じて検証を有効化してください。
- **取得件数**: 既定で `count=10000` を付与しています。サーバ上限で途切れる場合はページングの追加実装が必要です。
- **レスポンス差異**: タスクが `{"Task": {...}}` ラッパー形式で返る場合と、タスク本体が直接列挙される場合の両方に対応しています。

**トラブルシューティング**
- **ログイン失敗**: ユーザーID/パスワード、ネットワーク、API ベース URL を確認してください。
- **プロジェクトが表示されない**: 権限がない、または API 側でフィルタされている可能性があります。
- **Excel 出力失敗**: `openpyxl` が未インストール、またはファイルの書き込み権限/ファイル占有が原因の可能性があります。

**関連ファイル**
- `export_tasks_cli.py`: CUI エントリーポイント（ログイン/選択/エクスポート）
- `iquavis_client.py`: 認証・プロジェクト/タスク取得の API クライアント
- `excel_writer.py`: JSON フラット化と .xlsx 出力
- `AGENTS.md`: 要件・実装方針・参考抜粋
